<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Círculo de Quintas Minimal</title>
<script src="https://cdn.jsdelivr.net/npm/tone@14.8.41/build/Tone.js"></script>
<style>
  body {
    margin:0; display:flex; flex-direction:column; align-items:center;
    background:#f5f5f5; color:#111; font-family:'Helvetica Neue', sans-serif;
    height:100vh; justify-content:center;
  }
  h1 {
    font-weight:300; font-size:2em; margin-bottom:20px; color:#222;
  }
  svg {
    max-width:400px; width:90vw; height:90vw; background:#fff;
    border-radius:50%; display:block; margin:auto;
  }
  .note-circle {
    fill:#e0e0e0; stroke:#555; stroke-width:2; transition: transform 0.3s, fill 0.3s;
  }
  .note-circle.active {
    transform: scale(1.2);
  }
  .note-text {
    font-size:14px; text-anchor:middle; dominant-baseline:middle;
    fill:#333; font-weight:500;
  }
  polygon {
    fill:rgba(0,150,255,0.15); stroke:#0096ff; stroke-width:2; transition: all 0.3s ease;
  }
  #controls { margin-top:20px; display:flex; flex-wrap:wrap; gap:10px; justify-content:center; }
  select, button { padding:8px 12px; border-radius:6px; border:none; cursor:pointer; font-size:1em; }
  button:hover { background:#0096ff; color:#fff; }
  #selected-notes { margin-top:15px; font-size:1.2em; font-weight:500; color:#222; }
</style>
</head>
<body>

<h1>Círculo de Quintas Minimal</h1>

<svg id="circle-svg" viewBox="0 0 400 400">
  <polygon id="shape-polygon"/>
</svg>

<div id="controls">
  <label for="shape-selector">Forma:</label>
  <select id="shape-selector"></select>
  <button id="rotate-left">⟲ Rotar</button>
  <button id="rotate-right">⟳ Rotar</button>
  <button id="play-button">▶ Reproducir</button>
</div>

<div id="selected-notes"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const synth = new Tone.PolySynth(Tone.Synth).toDestination();
    const svg = document.getElementById('circle-svg');
    const shapePolygon = document.getElementById('shape-polygon');
    const selectedNotesDiv = document.getElementById('selected-notes');
    const shapeSelector = document.getElementById('shape-selector');
    const rotateLeftBtn = document.getElementById('rotate-left');
    const rotateRightBtn = document.getElementById('rotate-right');
    const playButton = document.getElementById('play-button');

    const notesInCircle = [
        { name: 'C', scientific: 'C4', color:'#FFD700' },
        { name: 'G', scientific: 'G4', color:'#FF8C00' },
        { name: 'D', scientific: 'D4', color:'#FF4500' },
        { name: 'A', scientific: 'A4', color:'#DC143C' },
        { name: 'E', scientific: 'E4', color:'#FF1493' },
        { name: 'B', scientific: 'B4', color:'#8A2BE2' },
        { name: 'F#', scientific: 'F#4', color:'#4B0082' },
        { name: 'C#', scientific: 'C#4', color:'#00CED1' },
        { name: 'G#', scientific: 'G#4', color:'#00BFFF' },
        { name: 'D#', scientific: 'D#4', color:'#1E90FF' },
        { name: 'A#', scientific: 'A#4', color:'#7FFF00' },
        { name: 'F', scientific: 'F4', color:'#32CD32' }
    ];

    const shapes = {
        3:{name:'Triángulo'},
        4:{name:'Cuadrado'},
        5:{name:'Pentágono'},
        6:{name:'Hexágono'},
        7:{name:'Heptágono'}
    };

    const centerX=200, centerY=200, radius=150, noteRadius=25;
    let currentRotation=0;
    let numVertices=3;

    function setupShapeSelector(){
        for(const v in shapes){
            const opt=document.createElement('option');
            opt.value=v; opt.textContent=shapes[v].name;
            shapeSelector.appendChild(opt);
        }
    }

    function drawCircle(){
        notesInCircle.forEach((note,i)=>{
            const angle = (i/12)*2*Math.PI - Math.PI/2;
            const x=centerX+radius*Math.cos(angle);
            const y=centerY+radius*Math.sin(angle);

            const circle=document.createElementNS("http://www.w3.org/2000/svg","circle");
            circle.setAttribute('id',`note-bg-${i}`);
            circle.setAttribute('class','note-circle');
            circle.setAttribute('cx',x);
            circle.setAttribute('cy',y);
            circle.setAttribute('r',noteRadius);
            circle.setAttribute('fill',note.color);
            svg.appendChild(circle);

            const text=document.createElementNS("http://www.w3.org/2000/svg","text");
            text.setAttribute('class','note-text');
            text.setAttribute('x',x);
            text.setAttribute('y',y);
            text.textContent=note.name;
            svg.appendChild(text);
        });
        svg.appendChild(shapePolygon);
    }

    function updateSelectionAndShape(){
        const points=[]; const selectedNotes=[];
        document.querySelectorAll('.note-circle.active').forEach(c=>c.classList.remove('active'));

        for(let i=0;i<numVertices;i++){
            const step=12/numVertices;
            const idx=Math.round((currentRotation + i*step)%12);
            const note=notesInCircle[idx];
            selectedNotes.push(note);
            const circle=document.getElementById(`note-bg-${idx}`);
            if(circle) circle.classList.add('active');
            const angle=(idx/12)*2*Math.PI - Math.PI/2;
            const x=centerX+radius*Math.cos(angle);
            const y=centerY+radius*Math.sin(angle);
            points.push(`${x},${y}`);
        }

        shapePolygon.setAttribute('points',points.join(' '));
        selectedNotesDiv.textContent = selectedNotes.map(n=>n.name).join(' - ');

        return selectedNotes.map(n=>n.scientific);
    }

    shapeSelector.addEventListener('change',e=>{
        numVertices=parseInt(e.target.value,10);
        updateSelectionAndShape();
    });

    rotateLeftBtn.addEventListener('click',()=>{
        currentRotation=(currentRotation-1+12)%12;
        updateSelectionAndShape();
    });

    rotateRightBtn.addEventListener('click',()=>{
        currentRotation=(currentRotation+1)%12;
        updateSelectionAndShape();
    });

    playButton.addEventListener('click',async ()=>{
        await Tone.start();
        const notesToPlay=updateSelectionAndShape();
        const interval=400;

        notesToPlay.forEach((note,i)=>{
            setTimeout(()=>synth.triggerAttackRelease(note,"8n"),i*interval);
            setTimeout(()=>{
                const idx=notesInCircle.findIndex(n=>n.scientific===note);
                document.querySelectorAll('.note-circle').forEach(c=>c.classList.remove('active'));
                const circle=document.getElementById(`note-bg-${idx}`);
                if(circle) circle.classList.add('active');
            },i*interval);
        });

        setTimeout(()=>updateSelectionAndShape(),notesToPlay.length*interval);
    });

    drawCircle();
    setupShapeSelector();
    updateSelectionAndShape();
});
</script>
</body>
</html>
