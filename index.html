<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Círculo de Quintas Interactivo</title>
<script src="https://cdn.jsdelivr.net/npm/tone@14.8.41/build/Tone.js"></script>
<style>
  body { background: #0a0a0a; color: #fff; font-family: sans-serif; display:flex; flex-direction:column; align-items:center; margin:0; height:100vh; }
  h1 { margin: 20px; font-size:2em; text-align:center; color:#0ff; }
  svg { border:1px solid rgba(255,255,255,0.1); margin-top:20px; background: radial-gradient(circle at center, #111 0%, #000 100%); }
  .note-circle { fill: #222; stroke:#0ff; stroke-width:2; transition: fill 0.3s, transform 0.3s; cursor:pointer; }
  .note-circle.active { fill: #0ff; transform: scale(1.2); }
  .note-text { font-size:14px; text-anchor:middle; dominant-baseline:middle; fill:#fff; }
  #controls { margin-top:20px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
  button, select { padding:8px 12px; border-radius:8px; border:none; cursor:pointer; font-size:1em; }
  button:hover { background:#0ff; color:#000; }
  #selected-notes { margin-top:15px; font-size:1.2em; }
</style>
</head>
<body>

<h1>Círculo de Quintas Interactivo</h1>

<svg id="circle-svg" width="400" height="400">
  <polygon id="shape-polygon" fill="rgba(0,255,255,0.2)" stroke="#0ff" stroke-width="2"/>
</svg>

<div id="controls">
  <label for="shape-selector">Selecciona forma:</label>
  <select id="shape-selector"></select>
  <button id="rotate-left">⟲ Rotar Izquierda</button>
  <button id="rotate-right">⟳ Rotar Derecha</button>
  <button id="play-button">▶ Reproducir</button>
</div>

<div id="selected-notes"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const synth = new Tone.PolySynth(Tone.Synth).toDestination();
    const svg = document.getElementById('circle-svg');
    const shapePolygon = document.getElementById('shape-polygon');
    const selectedNotesDiv = document.getElementById('selected-notes');
    const shapeSelector = document.getElementById('shape-selector');
    const rotateLeftBtn = document.getElementById('rotate-left');
    const rotateRightBtn = document.getElementById('rotate-right');
    const playButton = document.getElementById('play-button');

    const notesInCircle = [
        { name: 'C', scientific: 'C4' }, { name: 'G', scientific: 'G4' },
        { name: 'D', scientific: 'D4' }, { name: 'A', scientific: 'A4' },
        { name: 'E', scientific: 'E4' }, { name: 'B', scientific: 'B4' },
        { name: 'F#', scientific: 'F#4' }, { name: 'C#', scientific: 'C#4' },
        { name: 'G#', scientific: 'G#4' }, { name: 'D#', scientific: 'D#4' },
        { name: 'A#', scientific: 'A#4' }, { name: 'F', scientific: 'F4' }
    ];

    const shapes = {
        3: { name:'Triángulo (Acorde Mayor/Aumentado)' },
        4: { name:'Cuadrado (Acorde Disminuido 7)' },
        5: { name:'Pentágono (Escala Pentatónica)' },
        6: { name:'Hexágono (Escala Tonos Enteros)' },
        7: { name:'Heptágono (Escala Mayor/Menor)' }
    };

    const centerX = 200, centerY = 200, radius = 150, noteRadius = 25;
    let currentRotation = 0;
    let numVertices = 3;

    function setupShapeSelector(){
        for(const v in shapes){
            const opt = document.createElement('option');
            opt.value = v; opt.textContent = shapes[v].name;
            shapeSelector.appendChild(opt);
        }
    }

    function drawCircle(){
        notesInCircle.forEach((note,i)=>{
            const angle = (i/12)*2*Math.PI - Math.PI/2;
            const x = centerX + radius*Math.cos(angle);
            const y = centerY + radius*Math.sin(angle);

            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute('id',`note-bg-${i}`);
            circle.setAttribute('class','note-circle');
            circle.setAttribute('cx',x);
            circle.setAttribute('cy',y);
            circle.setAttribute('r',noteRadius);
            svg.appendChild(circle);

            const text = document.createElementNS("http://www.w3.org/2000/svg","text");
            text.setAttribute('class','note-text');
            text.setAttribute('x',x);
            text.setAttribute('y',y);
            text.textContent = note.name;
            svg.appendChild(text);
        });
        svg.appendChild(shapePolygon);
    }

    function updateSelectionAndShape(){
        const points = [];
        const selectedNotes = [];
        document.querySelectorAll('.note-circle.active').forEach(c=>c.classList.remove('active'));

        for(let i=0;i<numVertices;i++){
            const step = 12/numVertices;
            const idx = Math.round((currentRotation + i*step)%12);
            const note = notesInCircle[idx];
            selectedNotes.push(note);
            document.getElementById(`note-bg-${idx}`).classList.add('active');
            const angle = (idx/12)*2*Math.PI - Math.PI/2;
            const x = centerX + radius*Math.cos(angle);
            const y = centerY + radius*Math.sin(angle);
            points.push(`${x},${y}`);
        }

        shapePolygon.setAttribute('points',points.join(' '));
        selectedNotesDiv.textContent = selectedNotes.map(n=>n.name).join(' - ');

        return selectedNotes.map(n=>n.scientific);
    }

    shapeSelector.addEventListener('change', e=>{
        numVertices = parseInt(e.target.value,10);
        updateSelectionAndShape();
    });

    rotateLeftBtn.addEventListener('click', ()=>{
        currentRotation = (currentRotation-1+12)%12;
        updateSelectionAndShape();
    });

    rotateRightBtn.addEventListener('click', ()=>{
        currentRotation = (currentRotation+1)%12;
        updateSelectionAndShape();
    });

    playButton.addEventListener('click', async ()=>{
        await Tone.start();
        const notesToPlay = updateSelectionAndShape();
        const interval = 400; // ms entre notas

        notesToPlay.forEach((note,i)=>{
            setTimeout(()=>synth.triggerAttackRelease(note,"8n"),i*interval);
        });

        // Animación resaltado
        notesToPlay.forEach((note,i)=>{
            setTimeout(()=>{
                const idx = notesInCircle.findIndex(n=>n.scientific===note);
                document.querySelectorAll('.note-circle').forEach(c=>c.classList.remove('active'));
                if(document.getElementById(`note-bg-${idx}`)) document.getElementById(`note-bg-${idx}`).classList.add('active');
            }, i*interval);
        });

        setTimeout(()=>updateSelectionAndShape(), notesToPlay.length*interval);
    });

    drawCircle();
    setupShapeSelector();
    updateSelectionAndShape();
});
</script>

</body>
</html>
