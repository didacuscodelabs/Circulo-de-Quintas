<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Visualizador Minimal Musical</title>
<script src="https://cdn.jsdelivr.net/npm/tone@14.8.41/build/Tone.js"></script>
<style>
body {
  margin:0; background:#0a0f1a; display:flex; flex-direction:column;
  justify-content:center; align-items:center; height:100vh; font-family:sans-serif;
  color:#fff;
}
svg { width:80vw; max-width:500px; height:80vw; }
.circle-point { fill:#444; transition: all 0.3s ease; }
.circle-point.active { fill:#6c5ce7; r:10; }
line { stroke:#6c5ce7; stroke-width:1; opacity:0.3; transition: all 0.3s; }
line.active { opacity:0.8; }
#controls { margin-top:20px; display:flex; gap:10px; }
button { padding:8px 16px; border:none; border-radius:6px; background:#111; color:#fff; cursor:pointer; }
button:hover { background:#6c5ce7; }
</style>
</head>
<body>

<svg id="circle-svg" viewBox="0 0 400 400"></svg>
<div id="controls">
  <button id="play">▶ Iniciar</button>
  <button id="stop">■ Detener</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const svg = document.getElementById('circle-svg');
  const playBtn = document.getElementById('play');
  const stopBtn = document.getElementById('stop');

  const synth = new Tone.PolySynth(Tone.Synth, {
    oscillator: { type:'sine' },
    envelope: { attack:0.1, decay:0.3, sustain:0.4, release:1 }
  }).toDestination();

  const centerX=200, centerY=200, radius=150, numPoints=12;
  let points=[], lines=[], currentRotation=0, animationId, isPlaying=false;

  // Crear puntos en círculo
  for(let i=0;i<numPoints;i++){
    const angle=(i/numPoints)*2*Math.PI;
    const x=centerX+radius*Math.cos(angle);
    const y=centerY+radius*Math.sin(angle);
    const circle=document.createElementNS("http://www.w3.org/2000/svg","circle");
    circle.setAttribute('cx',x); circle.setAttribute('cy',y); circle.setAttribute('r',5);
    circle.setAttribute('class','circle-point');
    svg.appendChild(circle);
    points.push({x,y,el:circle});
  }

  // Crear líneas entre puntos
  for(let i=0;i<numPoints;i++){
    for(let j=i+1;j<numPoints;j++){
      const line=document.createElementNS("http://www.w3.org/2000/svg","line");
      line.setAttribute('x1',points[i].x); line.setAttribute('y1',points[i].y);
      line.setAttribute('x2',points[j].x); line.setAttribute('y2',points[j].y);
      svg.appendChild(line);
      lines.push(line);
    }
  }

  // Notas para cada punto
  const scaleNotes=['C4','D4','E4','G4','A4','B4','C5','D5','E5','G5','A5','B5'];

  function updateCircle(){
    currentRotation += 0.002; // giro suave
    points.forEach((p,i)=>{
      const angle=(i/numPoints)*2*Math.PI + currentRotation;
      const x=centerX+radius*Math.cos(angle);
      const y=centerY+radius*Math.sin(angle);
      p.el.setAttribute('cx',x); p.el.setAttribute('cy',y);
    });
    // actualizar líneas
    let lineIdx=0;
    for(let i=0;i<numPoints;i++){
      for(let j=i+1;j<numPoints;j++){
        lines[lineIdx].setAttribute('x1',points[i].el.cx.baseVal.value);
        lines[lineIdx].setAttribute('y1',points[i].el.cy.baseVal.value);
        lines[lineIdx].setAttribute('x2',points[j].el.cx.baseVal.value);
        lines[lineIdx].setAttribute('y2',points[j].el.cy.baseVal.value);
        lineIdx++;
      }
    }
  }

  let stepCount=0;
  function playStep(){
    updateCircle();
    // Encender punto rítmico
    const idx=Math.floor(stepCount%numPoints);
    points.forEach((p,i)=>p.el.classList.toggle('active',i===idx));
    // Tocar nota
    synth.triggerAttackRelease(scaleNotes[idx],'8n');
    stepCount++;
    animationId=requestAnimationFrame(playStep);
  }

  playBtn.addEventListener('click',()=>{
    if(!isPlaying){ isPlaying=true; Tone.start(); playStep(); }
  });
  stopBtn.addEventListener('click',()=>{
    isPlaying=false;
    cancelAnimationFrame(animationId);
    points.forEach(p=>p.el.classList.remove('active'));
  });
});
</script>

</body>
</html>
